import{Q as h,c as m,n as g,o as D,a as E,r as u,m as I,b as _,j as e,l as $,x as A,F as R}from"./index-4975aaaa.js";import{L as v}from"./LoadingButton-983b5e9c.js";import{g as U}from"./getObjectsStates-c20a5656.js";function y(r){return r.map(i=>({id:i.member_id,body:i}))}async function z(r,i,l,o){if(r.members.find(a=>a.member_id===i?a:null)){h.error("The user already exists");return}l(!0);try{const d=(await m.get(`user/${i}`)).data.user;o(s=>({...s,members:[...s.members,{username:d.username,role:d.role===""?"no role specified":d.role,member_id:d.user_id,is_leader:!1,image_url:d.image_url}]}))}catch{h.error("User id not found")}finally{l(!1)}}async function B(r,i,l,o,c){let a;r?a=await m.patch(`/project/${l}`,i):a=await m.post("/project",i);const d=U(y(o),y(i.members));for(const s of d.create)await m.post("/registration",{candidateID:s.member_id,projectID:a.data.project.project_id,is_leader:s.is_leader}),g.emit("create-registration",a.data.project.name,s.member_id===c,s.member_id);for(const s of d.update)await m.patch("/registration",{registeredUserID:s.member_id,projectID:a.data.project.project_id,is_leader:s.is_leader}),g.emit("update-registration",a.data.project.name,s.member_id);for(const s of d.delete)await m.delete(`/registration/${l}/${s.member_id}`),g.emit("delete-registration",a.data.project.name,!1,s.member_id);return a}function q(){const{user:r}=D(),i={name:"",description:"",members:[{member_id:(r==null?void 0:r.user_id)||"",username:(r==null?void 0:r.username)||"",role:!r||!r.role||r.role===""?"no role specified":r.role,is_leader:!0,image_url:(r==null?void 0:r.image_url)||""}]},l=E(),[o,c]=u.useState(i),[a,d]=u.useState(""),[s,N]=u.useState(!1),[w,j]=u.useState(!0),[C,k]=u.useState([]),{id:f}=I(),x=!!f;u.useEffect(()=>{(async()=>{try{if(x){const t=await m.get(`/project/members/${f}`);c(t.data.project),k(t.data.project.members)}}catch(t){_(t)}finally{j(!1)}})()},[]);function p(t){t.target.name!=="members"&&c(n=>({...n,[t.target.name]:t.target.value}))}async function S(){await z(o,a,N,c)}async function L(){j(!0);try{const t=await B(x,o,f||"",C,(r==null?void 0:r.user_id)||"");l(`/projects/${t.data.project.project_id}`)}catch(t){_(t)}finally{j(!1)}}function P(t){c(n=>({...n,members:n.members.filter(b=>{if(b.member_id!==t)return b})}))}function M(t){c(n=>({...n,members:n.members.map((b,F)=>F===t?{...b,is_leader:!b.is_leader}:b)}))}return e.jsx("div",{className:"p-6 w-full",children:o?e.jsxs("div",{className:"bg-white p-6 rounded-lg w-full",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{htmlFor:"title",className:"font-bold text-lg block mb-3",children:"Project title"}),e.jsx("input",{value:o.name,name:"name",id:"title",onChange:p,className:"rounded-md border-solid border-gray-200 border-2 mb-5 focus:border-black"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{htmlFor:"description",className:"font-bold text-lg block mb-3",children:"Project description"}),e.jsx("textarea",{name:"description",rows:7,id:"description",value:o.description,onChange:p,className:"rounded-md border-solid border-gray-200 border-2 w-full focus:border-black mb-5"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"my-4",children:["List of dummy member ids:",e.jsxs("ul",{className:"list-disc list-inside",children:[e.jsx("li",{children:"b260984b-68e6-4b1c-8ee4-1b26895292e5"}),e.jsx("li",{children:"47e04e23-0487-4b3c-87fe-15441cf8ff68"}),e.jsx("li",{children:"5532c806-2627-4634-83ad-85e0a771f5f6"})]})]}),e.jsx("label",{htmlFor:"addMem",className:"font-bold text-lg block mb-3",children:"Add more members to the project"}),e.jsx("input",{value:a,id:"addMem",onChange:t=>d(t.target.value),className:"rounded-md border-solid border-gray-200 border-2 mb-5 focus:border-black"}),s?e.jsx(v,{text:"Loading..."}):e.jsx("button",{onClick:S,disabled:s,className:"ml-4 border-blue-500 px-3 py-2 rounded-md border-solid text-center",children:s?"Loading...":"Add member"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-lg block mb-3",children:"Members"}),e.jsxs("div",{className:"grid grid-cols-1 border-gray-200 border rounded-lg mt-3 p-5 max-h-80 overflow-auto",children:[e.jsxs("div",{className:`mb-4 border-b-2 border-b-gray-200 grid grid-cols-4 [&>div]:text-center 
                  [&>div]:font-bold`,children:[e.jsx("div",{children:"Username"}),e.jsx("div",{children:"Role"}),e.jsx("div",{children:"Leader"}),e.jsx("div",{children:"Delete"})]}),o.members.map((t,n)=>e.jsxs("div",{className:`mb-4 pb-2 border-b-2 border-b-gray-200 grid grid-cols-4 
                        [&>div]:place-content-center [&>div]:flex`,children:[e.jsx("div",{children:t.username}),e.jsx("div",{className:"text-gray-400 mx-4",children:A(t.role,"no role")}),e.jsx("div",{children:e.jsx("input",{type:"checkbox",checked:t.is_leader,className:"disabled:cursor-not-allowed cursor-pointer scale-150",onChange:()=>M(n),disabled:t.member_id===(r==null?void 0:r.user_id)})}),e.jsx("div",{children:e.jsx("button",{onClick:()=>P(t.member_id),disabled:t.member_id===(r==null?void 0:r.user_id),className:"disabled:cursor-not-allowed flex place-content-center w-fit",children:e.jsx(R,{size:25})})})]},t.member_id))]})]}),e.jsxs("div",{className:"mt-8",children:[w?e.jsx(v,{text:x?"Saving...":"Creating..."}):e.jsx("button",{className:`mx-2 px-4 py-2 text-white bg-blue-500
                    rounded-xl font-bold border-blue-500 border-solid`,onClick:L,children:x?"Edit":"Create"}),e.jsx("button",{className:`px-4 py-2 text-blue-500 bg-white border-blue-500 
                border-solid rounded-xl font-bold`,onClick:()=>l(-1),children:"Cancel"})]})]}):e.jsx($,{size:"big"})})}export{q as default};
